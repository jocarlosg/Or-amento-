<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Or√ßamentos Offline</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --gray: #7f8c8d;
            --background: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: #333;
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
            font-size: 15px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
        }
        
        h1 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .app-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .view-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .view-toggle button {
            padding: 10px 18px;
            border: none;
            background-color: var(--light);
            color: var(--dark);
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 50px;
            font-size: 0.9rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .view-toggle button.active {
            background: linear-gradient(135deg, var(--secondary) 0%, #1a5d8f 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        #form-view, #list-view {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        #form-view:hover, #list-view:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }
        
        #list-view {
            display: none;
        }
        
        .form-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
        }
        
        .form-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .form-group {
            flex: 1 1 100%;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .required::after {
            content: " *";
            color: var(--danger);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            background-color: white;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        button i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, #1a5d8f 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #219653 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e67e22 100%);
            color: white;
        }
        
        .btn-light {
            background: linear-gradient(135deg, var(--light) 0%, #bdc3c7 100%);
            color: var(--dark);
        }
        
        button:hover {
            opacity: 0.92;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
        }
        
        #budget-list {
            margin-top: 15px;
        }
        
        .budget-item {
            background-color: white;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .budget-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--secondary);
        }
        
        .budget-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .budget-number {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
            background: rgba(44, 62, 80, 0.05);
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        .budget-date {
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .budget-client {
            font-weight: 700;
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 6px;
        }
        
        .budget-details {
            margin: 10px 0;
            color: #555;
            font-size: 0.9rem;
        }
        
        .budget-details div {
            margin-bottom: 5px;
        }
        
        .budget-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 15px;
            color: #d5dbdb;
        }
        
        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .logo-upload {
            display: inline-block;
            width: 140px;
            height: 90px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .logo-upload:hover {
            border-color: var(--secondary);
            background-color: #f0f8ff;
        }
        
        .logo-upload span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--gray);
            font-size: 0.8rem;
            text-align: center;
            width: 100%;
            padding: 0 10px;
        }
        
        #logo-preview {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        
        .signature-area {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
            text-align: center;
        }
        
        .signature-line {
            display: inline-block;
            width: 80%;
            max-width: 300px;
            border-top: 1px solid #333;
            margin-top: 40px;
        }
        
        .signature-label {
            margin-top: 6px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .status-pending {
            background-color: #fff8e1;
            color: #f57f17;
        }
        
        .status-approved {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-rejected {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .status-completed {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        footer {
            text-align: center;
            margin-top: 25px;
            padding: 15px;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        #search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            font-size: 0.95rem;
        }
        
        #search-btn {
            padding: 10px 18px;
        }
        
        .developer-credit {
            margin-top: 8px;
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 600;
        }
        
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.5s ease;
            font-size: 0.9rem;
            max-width: 90%;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #219653 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e67e22 100%);
        }
        
        .company-info {
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .company-logo-container {
            flex-shrink: 0;
            width: 100px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            overflow: hidden;
        }
        
        .company-logo-img {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        
        .company-details {
            flex-grow: 1;
        }
        
        .company-details div {
            margin-bottom: 6px;
            font-size: 1rem;
        }
        
        .company-details strong {
            font-size: 1.05rem;
        }
        
        .company-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .button-group, .budget-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .action-btn, .button-group button {
                width: 100%;
                justify-content: center;
            }
            
            .budget-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            header {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            #form-view, #list-view {
                padding: 15px;
            }
            
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
            }
            
            .company-info {
                flex-direction: column;
                text-align: center;
            }
            
            .company-logo-container {
                margin-bottom: 15px;
                width: 80px;
                height: 60px;
                margin-left: auto;
                margin-right: auto;
            }
        }
        
        @media (min-width: 768px) {
            .form-group {
                flex: 1 1 calc(50% - 15px);
            }
        }
        
        .company-config-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .company-config-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(30deg);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .close-modal {
            float: right;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: var(--gray);
        }
        
        .company-logo-upload {
            display: inline-block;
            width: 160px;
            height: 100px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .company-logo-upload:hover {
            border-color: var(--secondary);
            background-color: #f0f8ff;
        }
        
        .company-logo-upload span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--gray);
            font-size: 0.85rem;
            text-align: center;
            width: 100%;
            padding: 0 15px;
        }
        
        #company-logo-preview {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        
        .config-section {
            margin-bottom: 20px;
        }
        
        .config-section h3 {
            color: var(--primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .report-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .report-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .report-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .report-results {
            margin-top: 15px;
        }
        
        .marquee {
            background-color: var(--primary);
            color: white;
            padding: 10px 0;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .marquee-content {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 20s linear infinite;
        }
        
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .marquee-text {
            font-size: 0.9rem;
            display: inline-block;
            padding-right: 20px;
        }
        
        .marquee-text strong {
            color: var(--warning);
        }
        
        .pdf-back-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .pdf-back-btn.show {
            display: flex;
        }
        
        /* Estilo para o modal de visualiza√ß√£o do PDF */
        .pdf-viewer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 3000;
            overflow: auto;
        }
        
        .pdf-viewer-content {
            position: relative;
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .close-pdf-viewer {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-pdf-viewer:hover {
            color: #333;
        }
        
        .pdf-viewer-iframe {
            width: 100%;
            height: 70vh;
            border: none;
            border-radius: 4px;
        }
        
        .pdf-viewer-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .pdf-viewer-options button {
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .pdf-viewer-content {
                margin: 2% auto;
                width: 95%;
                padding: 10px;
            }
            
            .pdf-viewer-iframe {
                height: 80vh;
            }
            
            .pdf-viewer-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .pdf-viewer-options button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="marquee">
            <div class="marquee-content">
                <span class="marquee-text"><strong>Sistema Desenvolvido por Jos√© Carlos Gon√ßalves</strong> | Todos os direitos reservados | Vers√£o Ecosol001 | <strong>"Sozinhos somos bons, juntos somos incr√≠veis!"</strong></span>
            </div>
        </div>
        
        <header>
            <button class="company-config-btn" id="btn-company-config">
                <i class="fas fa-cog"></i>
            </button>
            <h1><i class="fas fa-file-invoice-dollar"></i> Sistema de Or√ßamentos</h1>
            <p>Gerencie seus or√ßamentos offline</p>
        </header>
        
        <div class="view-toggle">
            <button id="btn-show-form" class="active"><i class="fas fa-plus"></i> Novo</button>
            <button id="btn-show-list"><i class="fas fa-list"></i> Lista</button>
            <button id="btn-show-reports"><i class="fas fa-chart-bar"></i> Relat√≥rios</button>
        </div>
        
        <div id="form-view">
            <form id="budget-form">
                <div class="company-info">
                    <div class="company-logo-container">
                        <img id="company-logo-img" class="company-logo-img" alt="Logo da Empresa">
                    </div>
                    <div class="company-details">
                        <h3><i class="fas fa-building"></i> Dados da Empresa</h3>
                        <div><strong>Nome:</strong> <span id="company-name">Minha Empresa Ltda</span></div>
                        <div><strong>Endere√ßo:</strong> <span id="company-address">Rua Exemplo, 123 - Centro</span></div>
                        <div><strong>Contato:</strong> <span id="company-contact">(11) 99999-9999 | contato@empresa.com</span></div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2><i class="fas fa-user"></i> Dados do Cliente</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="client-name" class="required">Nome do Cliente</label>
                            <input type="text" id="client-name" required placeholder="Nome completo">
                        </div>
                        <div class="form-group">
                            <label for="client-contact">Contato</label>
                            <input type="text" id="client-contact" placeholder="Telefone/WhatsApp">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="client-address">Endere√ßo</label>
                        <input type="text" id="client-address" placeholder="Rua, n√∫mero, bairro, cidade">
                    </div>
                </div>
                
                <div class="form-section">
                    <h2><i class="fas fa-file-alt"></i> Detalhes do Or√ßamento</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tech-manager">Respons√°vel T√©cnico</label>
                            <input type="text" id="tech-manager" placeholder="Nome do respons√°vel">
                        </div>
                        <div class="form-group">
                            <label for="delivery-days">Prazo de Entrega</label>
                            <input type="text" id="delivery-days" placeholder="Ex: 15 dias ou 'A combinar'">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="services" class="required">Descri√ß√£o dos Servi√ßos</label>
                        <textarea id="services" required placeholder="Descreva detalhadamente os servi√ßos a serem realizados"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payment-method">Forma de Pagamento</label>
                            <select id="payment-method">
                                <option value="">Selecione...</option>
                                <option value="√Ä vista">√Ä vista</option>
                                <option value="Parcelado">Parcelado</option>
                                <option value="Boleto">Boleto</option>
                                <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                                <option value="Transfer√™ncia">Transfer√™ncia</option>
                                <option value="PIX">PIX</option>
                                <option value="A Combinar">A Combinar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="total-value" class="required">Valor Total (R$)</label>
                            <input type="number" id="total-value" step="0.01" min="0" required placeholder="0,00">
                        </div>
                    </div>
                    
                    <div class="form-group" id="status-group" style="display: none;">
                        <label for="status">Status do Or√ßamento</label>
                        <select id="status">
                            <option value="pendente">Pendente</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="reprovado">Reprovado</option>
                            <option value="executado">Executado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" id="btn-save" class="btn-primary"><i class="fas fa-save"></i> Salvar</button>
                    <button type="reset" class="btn-light"><i class="fas fa-broom"></i> Limpar</button>
                </div>
            </form>
        </div>
        
        <div id="list-view">
            <div class="app-controls">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Buscar por cliente...">
                    <button id="search-btn" class="btn-primary"><i class="fas fa-search"></i></button>
                </div>
                <button id="btn-refresh" class="btn-light"><i class="fas fa-sync-alt"></i> Atualizar</button>
            </div>
            
            <div id="budget-list">
                <div class="empty-state">
                    <div><i class="fas fa-file-invoice"></i></div>
                    <h3>Nenhum or√ßamento encontrado</h3>
                    <p>Comece criando seu primeiro or√ßamento</p>
                </div>
            </div>
        </div>
        
        <div id="reports-view" style="display: none;">
            <div class="report-section">
                <h3><i class="fas fa-chart-pie"></i> Relat√≥rio de Or√ßamentos</h3>
                
                <div class="report-filters">
                    <div class="form-group">
                        <label for="report-status">Status</label>
                        <select id="report-status">
                            <option value="todos">Todos</option>
                            <option value="pendente">Pendente</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="reprovado">Reprovado</option>
                            <option value="executado">Executado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="report-start-date">Data Inicial</label>
                        <input type="date" id="report-start-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="report-end-date">Data Final</label>
                        <input type="date" id="report-end-date">
                    </div>
                    
                    <button id="btn-generate-report" class="btn-primary"><i class="fas fa-filter"></i> Gerar Relat√≥rio</button>
                    <button id="btn-export-report" class="btn-success"><i class="fas fa-file-excel"></i> Exportar</button>
                </div>
                
                <div class="report-results">
                    <div class="empty-state">
                        <div><i class="fas fa-chart-line"></i></div>
                        <h3>Nenhum filtro aplicado</h3>
                        <p>Selecione os filtros e clique em "Gerar Relat√≥rio"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema de Or√ßamentos Offline | Funciona sem internet | ¬© 2023</p>
        <div class="developer-credit">
            Desenvolvido por Jos√© Carlos Gon√ßalves
        </div>
    </footer>
    
    <div id="notification" class="notification"></div>
    
    <button id="pdf-back-btn" class="pdf-back-btn" title="Voltar para o sistema">
        <i class="fas fa-arrow-left"></i>
    </button>
    
    <!-- Modal de Configura√ß√£o da Empresa -->
    <div id="company-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-company-modal">&times;</span>
            <h2><i class="fas fa-building"></i> Configura√ß√µes da Empresa</h2>
            
            <div class="config-section">
                <h3>Logo da Empresa</h3>
                <div class="company-logo-container">
                    <div class="company-logo-upload" id="company-logo-upload-area">
                        <span>Clique para adicionar logo</span>
                        <img id="company-logo-preview" alt="Company Logo Preview">
                    </div>
                    <input type="file" id="company-logo-upload" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <div class="config-section">
                <h3>Dados da Empresa</h3>
                <div class="form-group">
                    <label for="company-name-input">Nome da Empresa</label>
                    <input type="text" id="company-name-input" placeholder="Nome completo da empresa">
                </div>
                
                <div class="form-group">
                    <label for="company-address-input">Endere√ßo</label>
                    <input type="text" id="company-address-input" placeholder="Endere√ßo completo">
                </div>
                
                <div class="form-group">
                    <label for="company-contact-input">Contato</label>
                    <input type="text" id="company-contact-input" placeholder="Telefone, email, etc.">
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" id="btn-save-company" class="btn-primary"><i class="fas fa-save"></i> Salvar Configura√ß√µes</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para visualiza√ß√£o do PDF -->
    <div id="pdf-viewer-modal" class="pdf-viewer-modal">
        <div class="pdf-viewer-content">
            <span class="close-pdf-viewer">&times;</span>
            <iframe id="pdf-viewer-iframe" class="pdf-viewer-iframe"></iframe>
            <div class="pdf-viewer-options">
                <button id="pdf-download-btn" class="btn-primary"><i class="fas fa-download"></i> Baixar PDF</button>
                <button id="pdf-print-btn" class="btn-success"><i class="fas fa-print"></i> Imprimir</button>
                <button id="pdf-close-btn" class="btn-danger"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>
    
    <script>
        // Verifica suporte a IndexedDB
        if (!('indexedDB' in window)) {
            showNotification('Seu navegador n√£o suporta IndexedDB. O sistema n√£o funcionar√° corretamente.', 'error');
        }

        // Inicializa o banco de dados
        const DB_NAME = 'BudgetDB';
        const DB_VERSION = 4;
        const STORE_NAME = 'budgets';
        const COMPANY_STORE = 'company';
        
        let db;
        let currentBudgetId = null;
        let companyLogoBase64 = null;
        let currentPdfBlob = null;
        
        // Dados padr√£o da empresa
        let companyData = {
            name: "Minha Empresa Ltda",
            address: "Rua Exemplo, 123 - Centro",
            contact: "(11) 99999-9999 | contato@empresa.com",
            logo: null
        };

        // Fun√ß√£o para mostrar notifica√ß√µes
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Abre ou cria o banco de dados
        const openDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    
                    // Cria a object store para or√ßamentos
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const store = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        store.createIndex('number', 'number', { unique: true });
                        store.createIndex('clientName', 'clientName', { unique: false });
                        store.createIndex('status', 'status', { unique: false });
                        store.createIndex('timestamp', 'timestamp', { unique: false });
                    }
                    
                    // Cria a object store para dados da empresa
                    if (!db.objectStoreNames.contains(COMPANY_STORE)) {
                        db.createObjectStore(COMPANY_STORE);
                    }
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    resolve(db);
                };
                
                request.onerror = (event) => {
                    reject('Erro ao abrir o banco de dados: ' + event.target.error);
                };
            });
        };
        
        // Carrega dados da empresa
        const loadCompanyData = async () => {
            try {
                if (!db) return;
                
                const transaction = db.transaction([COMPANY_STORE], 'readonly');
                const store = transaction.objectStore(COMPANY_STORE);
                const request = store.get('companyData');
                
                return new Promise((resolve) => {
                    request.onsuccess = (event) => {
                        if (event.target.result) {
                            companyData = event.target.result;
                            updateCompanyInfoDisplay();
                        }
                        resolve();
                    };
                    
                    request.onerror = () => resolve();
                });
            } catch (error) {
                console.error('Erro ao carregar dados da empresa:', error);
            }
        };
        
        // Salva dados da empresa
        const saveCompanyData = async () => {
            try {
                if (!db) return;
                
                const transaction = db.transaction([COMPANY_STORE], 'readwrite');
                const store = transaction.objectStore(COMPANY_STORE);
                store.put(companyData, 'companyData');
                showNotification('Dados da empresa salvos com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar dados da empresa:', error);
                showNotification('Erro ao salvar dados da empresa: ' + error, 'error');
            }
        };
        
        // Atualiza exibi√ß√£o dos dados da empresa
        const updateCompanyInfoDisplay = () => {
            const companyName = document.getElementById('company-name');
            const companyAddress = document.getElementById('company-address');
            const companyContact = document.getElementById('company-contact');
            const companyLogoImg = document.getElementById('company-logo-img');
            
            if (companyName) companyName.textContent = companyData.name;
            if (companyAddress) companyAddress.textContent = companyData.address;
            if (companyContact) companyContact.textContent = companyData.contact;
            
            if (companyData.logo && companyLogoImg) {
                companyLogoImg.src = companyData.logo;
                companyLogoImg.style.display = 'block';
            }
        };
        
        // Fun√ß√£o para gerar o pr√≥ximo n√∫mero de or√ßamento
        const getNextBudgetNumber = async () => {
            try {
                if (!db) return '001';
                
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const index = store.index('number');
                const request = index.openCursor(null, 'prev');
                
                return new Promise((resolve) => {
                    request.onsuccess = (event) => {
                        const cursor = event.target.result;
                        if (cursor) {
                            const lastNumber = parseInt(cursor.value.number);
                            resolve(String(lastNumber + 1).padStart(3, '0'));
                        } else {
                            resolve('001');
                        }
                    };
                    
                    request.onerror = () => resolve('001');
                });
            } catch (error) {
                console.error('Erro ao obter pr√≥ximo n√∫mero:', error);
                return '001';
            }
        };
        
        // Salva um or√ßamento no banco de dados
        const saveBudget = async (budget) => {
            if (!db) throw new Error('Banco de dados n√£o inicializado');
            
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            
            return new Promise((resolve, reject) => {
                const request = store.put(budget);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = (event) => reject('Erro ao salvar or√ßamento: ' + event.target.error);
            });
        };
        
        // Obt√©m todos os or√ßamentos
        const getAllBudgets = async () => {
            if (!db) return [];
            
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            
            return new Promise((resolve, reject) => {
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = (event) => reject('Erro ao obter or√ßamentos: ' + event.target.error);
            });
        };
        
        // Busca or√ßamentos por filtros
        const searchBudgetsByFilters = async (filters = {}) => {
            if (!db) return [];
            
            const { status, startDate, endDate } = filters;
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            
            // Se n√£o h√° filtros, retorna todos
            if (!status && !startDate && !endDate) {
                return getAllBudgets();
            }
            
            let range;
            if (startDate && endDate) {
                range = IDBKeyRange.bound(
                    new Date(startDate).getTime(),
                    new Date(endDate + 'T23:59:59').getTime()
                );
            } else if (startDate) {
                range = IDBKeyRange.lowerBound(new Date(startDate).getTime());
            } else if (endDate) {
                range = IDBKeyRange.upperBound(new Date(endDate + 'T23:59:59').getTime());
            }
            
            return new Promise((resolve, reject) => {
                let request;
                if (status && status !== 'todos') {
                    if (range) {
                        // Filtra por status e data
                        const index = store.index('status');
                        request = index.getAll(status);
                    } else {
                        // Filtra apenas por status
                        const index = store.index('status');
                        request = index.getAll(status);
                    }
                } else if (range) {
                    // Filtra apenas por data
                    const index = store.index('timestamp');
                    request = index.getAll(range);
                } else {
                    // Sem filtros v√°lidos
                    request = store.getAll();
                }
                
                request.onsuccess = () => {
                    let results = request.result || [];
                    
                    // Aplica filtro de data se necess√°rio (para casos onde filtramos apenas por status)
                    if (range && (!status || status === 'todos')) {
                        results = results.filter(budget => {
                            const budgetDate = new Date(budget.timestamp).getTime();
                            return (!startDate || budgetDate >= new Date(startDate).getTime()) &&
                                   (!endDate || budgetDate <= new Date(endDate + 'T23:59:59').getTime());
                        });
                    }
                    
                    resolve(results);
                };
                
                request.onerror = (event) => reject('Erro ao buscar or√ßamentos: ' + event.target.error);
            });
        };
        
        // Exclui um or√ßamento
        const deleteBudget = async (id) => {
            if (!db) throw new Error('Banco de dados n√£o inicializado');
            
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            
            return new Promise((resolve, reject) => {
                const request = store.delete(id);
                
                request.onsuccess = () => resolve();
                request.onerror = (event) => reject('Erro ao excluir or√ßamento: ' + event.target.error);
            });
        };
        
        // Obt√©m um or√ßamento por ID
        const getBudgetById = async (id) => {
            if (!db) return null;
            
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            
            return new Promise((resolve, reject) => {
                const request = store.get(id);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = (event) => reject('Erro ao obter or√ßamento: ' + event.target.error);
            });
        };
        
        // Renderiza a lista de or√ßamentos
        const renderBudgetList = async (budgets = null) => {
            const budgetList = document.getElementById('budget-list');
            if (!budgetList) return;
            
            const budgetsToRender = budgets || await getAllBudgets();
            
            if (budgetsToRender.length === 0) {
                budgetList.innerHTML = `
                    <div class="empty-state">
                        <div><i class="fas fa-file-invoice"></i></div>
                        <h3>Nenhum or√ßamento encontrado</h3>
                        <p>Comece criando seu primeiro or√ßamento</p>
                    </div>
                `;
                return;
            }
            
            budgetList.innerHTML = '';
            
            // Ordena por data (mais recente primeiro)
            budgetsToRender.sort((a, b) => b.timestamp - a.timestamp);
            
            budgetsToRender.forEach(budget => {
                let statusClass = '';
                let statusText = '';
                
                switch(budget.status) {
                    case 'aprovado':
                        statusClass = 'status-approved';
                        statusText = 'APROVADO';
                        break;
                    case 'reprovado':
                        statusClass = 'status-rejected';
                        statusText = 'REPROVADO';
                        break;
                    case 'executado':
                        statusClass = 'status-completed';
                        statusText = 'EXECUTADO';
                        break;
                    case 'cancelado':
                        statusClass = 'status-rejected';
                        statusText = 'CANCELADO';
                        break;
                    default:
                        statusClass = 'status-pending';
                        statusText = 'PENDENTE';
                }
                
                const budgetElement = document.createElement('div');
                budgetElement.className = 'budget-item';
                budgetElement.innerHTML = `
                    <div class="budget-header">
                        <div>
                            <span class="budget-number">Or√ßamento #${budget.number}</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="budget-date">${new Date(budget.timestamp).toLocaleDateString()}</div>
                    </div>
                    <div class="budget-client">${budget.clientName}</div>
                    <div class="budget-details">
                        <div><strong>Valor:</strong> R$ ${parseFloat(budget.totalValue).toFixed(2)}</div>
                        <div><strong>Prazo:</strong> ${budget.deliveryDays || 'A combinar'}</div>
                        <div><strong>Pagamento:</strong> ${budget.paymentMethod || 'A combinar'}</div>
                    </div>
                    <div class="budget-actions">
                        <button class="btn-warning action-btn edit-btn" data-id="${budget.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn-danger action-btn delete-btn" data-id="${budget.id}"><i class="fas fa-trash"></i></button>
                        <button class="btn-primary action-btn pdf-btn" data-id="${budget.id}"><i class="fas fa-file-pdf"></i></button>
                        <button class="btn-success action-btn share-btn" data-id="${budget.id}"><i class="fas fa-share-alt"></i></button>
                    </div>
                `;
                budgetList.appendChild(budgetElement);
            });
            
            // Adiciona event listeners aos bot√µes
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    await loadBudgetForEditing(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    if (confirm('Tem certeza que deseja excluir este or√ßamento? Esta a√ß√£o n√£o pode ser desfeita.')) {
                        try {
                            await deleteBudget(id);
                            await renderBudgetList();
                            showNotification('Or√ßamento exclu√≠do com sucesso!');
                        } catch (error) {
                            showNotification('Erro ao excluir or√ßamento: ' + error, 'error');
                        }
                    }
                });
            });
            
            document.querySelectorAll('.pdf-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    await generatePDF(id);
                });
            });
            
            document.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    await shareBudget(id);
                });
            });
        };
        
        // Renderiza o relat√≥rio de or√ßamentos
        const renderReport = async (budgets = []) => {
            const reportResults = document.querySelector('#reports-view .report-results');
            if (!reportResults) return;
            
            if (budgets.length === 0) {
                reportResults.innerHTML = `
                    <div class="empty-state">
                        <div><i class="fas fa-chart-line"></i></div>
                        <h3>Nenhum resultado encontrado</h3>
                        <p>Nenhum or√ßamento corresponde aos filtros aplicados</p>
                    </div>
                `;
                return;
            }
            
            // Agrupa por status para o resumo
            const summary = {
                pendente: 0,
                aprovado: 0,
                reprovado: 0,
                executado: 0,
                cancelado: 0,
                total: 0,
                valorTotal: 0
            };
            
            budgets.forEach(budget => {
                summary[budget.status] = (summary[budget.status] || 0) + 1;
                summary.total++;
                summary.valorTotal += parseFloat(budget.totalValue || 0);
            });
            
            // Formata os dados para exibi√ß√£o
            const formattedData = budgets.map(budget => {
                return {
                    ...budget,
                    date: new Date(budget.timestamp).toLocaleDateString(),
                    value: parseFloat(budget.totalValue).toFixed(2)
                };
            });
            
            // Cria o HTML do relat√≥rio
            let html = `
                <div class="report-summary">
                    <h4><i class="fas fa-chart-pie"></i> Resumo do Relat√≥rio</h4>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-value">${summary.total}</div>
                            <div class="summary-label">Total de Or√ßamentos</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">R$ ${summary.valorTotal.toFixed(2)}</div>
                            <div class="summary-label">Valor Total</div>
                        </div>
                        <div class="summary-card status-pending">
                            <div class="summary-value">${summary.pendente}</div>
                            <div class="summary-label">Pendentes</div>
                        </div>
                        <div class="summary-card status-approved">
                            <div class="summary-value">${summary.aprovado}</div>
                            <div class="summary-label">Aprovados</div>
                        </div>
                        <div class="summary-card status-rejected">
                            <div class="summary-value">${summary.reprovado}</div>
                            <div class="summary-label">Reprovados</div>
                        </div>
                        <div class="summary-card status-completed">
                            <div class="summary-value">${summary.executado}</div>
                            <div class="summary-label">Executados</div>
                        </div>
                        <div class="summary-card status-rejected">
                            <div class="summary-value">${summary.cancelado}</div>
                            <div class="summary-label">Cancelados</div>
                        </div>
                    </div>
                </div>
                
                <div class="report-table">
                    <h4><i class="fas fa-table"></i> Detalhes dos Or√ßamentos</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>N√∫mero</th>
                                <th>Cliente</th>
                                <th>Data</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            formattedData.forEach(budget => {
                let statusClass = '';
                let statusText = '';
                
                switch(budget.status) {
                    case 'aprovado':
                        statusClass = 'status-approved';
                        statusText = 'Aprovado';
                        break;
                    case 'reprovado':
                        statusClass = 'status-rejected';
                        statusText = 'Reprovado';
                        break;
                    case 'executado':
                        statusClass = 'status-completed';
                        statusText = 'Executado';
                        break;
                    case 'cancelado':
                        statusClass = 'status-rejected';
                        statusText = 'Cancelado';
                        break;
                    default:
                        statusClass = 'status-pending';
                        statusText = 'Pendente';
                }
                
                html += `
                    <tr>
                        <td>#${budget.number}</td>
                        <td>${budget.clientName}</td>
                        <td>${budget.date}</td>
                        <td>R$ ${budget.value}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-warning action-btn edit-btn" data-id="${budget.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn-primary action-btn pdf-btn" data-id="${budget.id}"><i class="fas fa-file-pdf"></i></button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                
                <style>
                    .report-summary {
                        margin-bottom: 20px;
                        background: white;
                        padding: 15px;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    
                    .summary-cards {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                        gap: 15px;
                        margin-top: 15px;
                    }
                    
                    .summary-card {
                        background: white;
                        border-radius: 8px;
                        padding: 15px;
                        text-align: center;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                        border-top: 3px solid var(--secondary);
                    }
                    
                    .summary-card.status-pending {
                        border-top-color: #f39c12;
                    }
                    
                    .summary-card.status-approved {
                        border-top-color: #27ae60;
                    }
                    
                    .summary-card.status-rejected {
                        border-top-color: #e74c3c;
                    }
                    
                    .summary-card.status-completed {
                        border-top-color: #3498db;
                    }
                    
                    .summary-value {
                        font-size: 1.5rem;
                        font-weight: bold;
                        margin-bottom: 5px;
                    }
                    
                    .summary-label {
                        font-size: 0.85rem;
                        color: var(--gray);
                    }
                    
                    .report-table {
                        background: white;
                        padding: 15px;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        overflow-x: auto;
                    }
                    
                    .report-table table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    
                    .report-table th, .report-table td {
                        padding: 10px;
                        text-align: left;
                        border-bottom: 1px solid #eee;
                    }
                    
                    .report-table th {
                        background-color: #f8f9fa;
                        font-weight: 600;
                    }
                    
                    .report-table tr:hover {
                        background-color: #f5f5f5;
                    }
                    
                    .report-table .action-btn {
                        padding: 5px 10px;
                        font-size: 0.8rem;
                    }
                </style>
            `;
            
            reportResults.innerHTML = html;
            
            // Adiciona event listeners aos bot√µes na tabela
            document.querySelectorAll('.report-table .edit-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    await loadBudgetForEditing(id);
                });
            });
            
            document.querySelectorAll('.report-table .pdf-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    await generatePDF(id);
                });
            });
        };
        
        // Exporta relat√≥rio para Excel
        const exportReportToExcel = async (budgets) => {
            try {
                // Cria um arquivo CSV simples
                let csvContent = "N√∫mero,Cliente,Data,Valor,Status,Prazo,Forma Pagamento\n";
                
                budgets.forEach(budget => {
                    const date = new Date(budget.timestamp).toLocaleDateString();
                    const value = parseFloat(budget.totalValue).toFixed(2);
                    const status = budget.status || 'pendente';
                    const delivery = budget.deliveryDays || 'A combinar';
                    const payment = budget.paymentMethod || 'A combinar';
                    
                    csvContent += `"${budget.number}","${budget.clientName}","${date}","${value}","${status}","${delivery}","${payment}"\n`;
                });
                
                // Cria um blob com o conte√∫do
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                // Cria um link para download
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `relatorio_orcamentos_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Relat√≥rio exportado com sucesso!');
            } catch (error) {
                console.error('Erro ao exportar relat√≥rio:', error);
                showNotification('Erro ao exportar relat√≥rio: ' + error.message, 'error');
            }
        };
        
        // Carrega um or√ßamento para edi√ß√£o
        const loadBudgetForEditing = async (id) => {
            const budget = await getBudgetById(id);
            
            if (!budget) return;
            
            currentBudgetId = id;
            document.getElementById('client-name').value = budget.clientName || '';
            document.getElementById('client-address').value = budget.clientAddress || '';
            document.getElementById('client-contact').value = budget.clientContact || '';
            document.getElementById('tech-manager').value = budget.techManager || '';
            document.getElementById('services').value = budget.services || '';
            document.getElementById('delivery-days').value = budget.deliveryDays || '';
            document.getElementById('payment-method').value = budget.paymentMethod || '';
            document.getElementById('total-value').value = budget.totalValue || '';
            
            // Mostra e define o status
            const statusGroup = document.getElementById('status-group');
            const statusSelect = document.getElementById('status');
            if (statusGroup && statusSelect) {
                statusGroup.style.display = 'block';
                statusSelect.value = budget.status || 'pendente';
            }
            
            document.getElementById('btn-show-form').click();
            const btnSave = document.getElementById('btn-save');
            if (btnSave) {
                btnSave.innerHTML = '<i class="fas fa-save"></i> Atualizar Or√ßamento';
            }
        };
        
        // Converte imagem para base64
        const convertImageToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };
        
        // Gera PDF do or√ßamento (VERS√ÉO ATUALIZADA)
        const generatePDF = async (id) => {
            try {
                const budget = await getBudgetById(id);
                if (!budget) return;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const margin = 15;
                const pageWidth = doc.internal.pageSize.getWidth();
                const contentWidth = pageWidth - (margin * 2);
                const lineHeight = 7;
                const maxHeight = doc.internal.pageSize.getHeight() - margin;
                
                // Configura√ß√µes de estilo
                const styles = {
                    title: { fontSize: 16, fontStyle: 'bold', textColor: [0, 0, 0] },
                    subtitle: { fontSize: 12, fontStyle: 'bold', textColor: [0, 0, 0] },
                    normal: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] },
                    small: { fontSize: 9, fontStyle: 'normal', textColor: [100, 100, 100] }
                };

                // Fun√ß√£o para adicionar texto com estilo
                const addText = (text, x, y, style = 'normal', align = 'left', maxWidth = contentWidth) => {
                    doc.setFontSize(styles[style].fontSize);
                    doc.setFont(undefined, styles[style].fontStyle);
                    doc.setTextColor(...styles[style].textColor);
                    
                    // Divide o texto em linhas que cabem na largura m√°xima
                    const lines = doc.splitTextToSize(text, maxWidth);
                    
                    // Adiciona cada linha, verificando espa√ßo na p√°gina
                    let currentY = y;
                    for (let i = 0; i < lines.length; i++) {
                        // Verifica se h√° espa√ßo para mais uma linha
                        if (currentY + lineHeight > maxHeight) {
                            doc.addPage();
                            currentY = margin;
                            
                            // Se for continua√ß√£o da descri√ß√£o, adiciona cabe√ßalho
                            if (style === 'normal' && i > 0) {
                                addText('Descri√ß√£o dos Servi√ßos (continua√ß√£o)', margin, currentY, 'subtitle');
                                currentY += lineHeight * 1.5;
                            }
                        }
                        
                        doc.text(lines[i], x, currentY, { align, maxWidth });
                        currentY += lineHeight;
                    }
                    
                    return currentY;
                };

                let y = margin;

                // Cabe√ßalho com logo e dados da empresa
                const headerY = margin;
                
                // Logo da empresa (esquerda)
                if (companyData.logo) {
                    try {
                        const logo = new Image();
                        logo.src = companyData.logo;
                        
                        await new Promise(resolve => {
                            logo.onload = resolve;
                            logo.onerror = resolve;
                        });
                        
                        const logoWidth = 40;
                        const logoHeight = (logo.height * logoWidth) / logo.width;
                        
                        if (logoHeight > 0) {
                            doc.addImage(companyData.logo, 'PNG', margin, headerY, logoWidth, logoHeight);
                            
                            // Dados da empresa (direita do logo)
                            const companyX = margin + logoWidth + 10;
                            
                            y = addText(companyData.name, companyX, headerY + 5, 'title');
                            y = addText(companyData.address, companyX, y, 'normal');
                            y = addText(companyData.contact, companyX, y, 'normal');
                            
                            y = headerY + logoHeight + 10;
                        }
                    } catch (e) {
                        console.error('Erro ao adicionar logo:', e);
                        // Fallback sem logo
                        y = addText(companyData.name, margin, y, 'title', 'center');
                        y = addText(companyData.address, margin, y, 'normal', 'center');
                        y = addText(companyData.contact, margin, y, 'normal', 'center');
                    }
                } else {
                    // Cabe√ßalho sem logo
                    y = addText(companyData.name, margin, y, 'title', 'center');
                    y = addText(companyData.address, margin, y, 'normal', 'center');
                    y = addText(companyData.contact, margin, y, 'normal', 'center');
                }

                // Linha divis√≥ria
                y += 5;
                if (y > maxHeight - 20) {
                    doc.addPage();
                    y = margin;
                }
                
                doc.setLineWidth(0.5);
                doc.line(margin, y, pageWidth - margin, y);
                y += 10;

                // T√≠tulo do or√ßamento
                y = addText(`OR√áAMENTO #${budget.number}`, pageWidth / 2, y, 'title', 'center');
                
                // Data e status
                y = addText(`Data: ${new Date(budget.timestamp).toLocaleDateString()}`, pageWidth - margin, y, 'normal', 'right');
                
                let statusText = '';
                switch(budget.status) {
                    case 'aprovado': statusText = 'APROVADO'; break;
                    case 'reprovado': statusText = 'REPROVADO'; break;
                    case 'executado': statusText = 'EXECUTADO'; break;
                    case 'cancelado': statusText = 'CANCELADO'; break;
                    default: statusText = 'PENDENTE';
                }
                y = addText(`Status: ${statusText}`, margin, y, 'normal');

                // Dados do cliente
                y += 10;
                if (y > maxHeight - 20) {
                    doc.addPage();
                    y = margin;
                }
                
                y = addText('DADOS DO CLIENTE', margin, y, 'subtitle');
                
                y = addText(`Nome: ${budget.clientName}`, margin, y, 'normal');
                y = addText(`Endere√ßo: ${budget.clientAddress || 'N√£o informado'}`, margin, y, 'normal');
                y = addText(`Contato: ${budget.clientContact || 'N√£o informado'}`, margin, y, 'normal');

                // Detalhes do or√ßamento
                y += 10;
                if (y > maxHeight - 20) {
                    doc.addPage();
                    y = margin;
                }
                
                y = addText('DETALHES DO OR√áAMENTO', margin, y, 'subtitle');
                
                y = addText(`Respons√°vel T√©cnico: ${budget.techManager || 'N√£o informado'}`, margin, y, 'normal');
                y = addText(`Prazo de Entrega: ${budget.deliveryDays || 'A combinar'}`, margin, y, 'normal');
                y = addText(`Forma de Pagamento: ${budget.paymentMethod || 'A combinar'}`, margin, y, 'normal');
                y = addText(`Valor Total: R$ ${parseFloat(budget.totalValue).toFixed(2)}`, margin, y, 'normal');

                // Descri√ß√£o dos servi√ßos com quebra de p√°gina autom√°tica
                y += 10;
                if (y > maxHeight - 20) {
                    doc.addPage();
                    y = margin;
                }
                
                y = addText('DESCRI√á√ÉO DOS SERVI√áOS', margin, y, 'subtitle');
                y = addText(budget.services, margin, y, 'normal');

                // Assinatura
                y += 20;
                if (y > maxHeight - 30) {
                    doc.addPage();
                    y = margin;
                }
                
                y = addText('ASSINATURA', margin, y, 'subtitle');
                y += 15;
                
                doc.setLineWidth(0.5);
                doc.line(margin, y, margin + 70, y);
                y = addText('Cliente', margin, y + 10, 'small');
                
                doc.line(pageWidth - margin - 70, y - 10, pageWidth - margin, y - 10);
                y = addText('Respons√°vel T√©cnico', pageWidth - margin - 70, y, 'small');

                // Gera o PDF e abre para visualiza√ß√£o
                const pdfBlob = doc.output('blob');
                currentPdfBlob = pdfBlob;
                const pdfUrl = URL.createObjectURL(pdfBlob);
                
                // Mostra o modal de visualiza√ß√£o do PDF
                const pdfViewerModal = document.getElementById('pdf-viewer-modal');
                const pdfViewerIframe = document.getElementById('pdf-viewer-iframe');
                const closePdfViewer = document.querySelector('.close-pdf-viewer');
                const pdfDownloadBtn = document.getElementById('pdf-download-btn');
                const pdfPrintBtn = document.getElementById('pdf-print-btn');
                const pdfCloseBtn = document.getElementById('pdf-close-btn');
                
                if (pdfViewerModal && pdfViewerIframe) {
                    pdfViewerIframe.src = pdfUrl;
                    pdfViewerModal.style.display = 'block';
                    
                    // Configura os bot√µes do modal
                    if (pdfDownloadBtn) {
                        pdfDownloadBtn.onclick = () => {
                            const link = document.createElement('a');
                            link.href = URL.createObjectURL(pdfBlob);
                            link.download = `orcamento_${budget.number}.pdf`;
                            link.click();
                        };
                    }
                    
                    if (pdfPrintBtn) {
                        pdfPrintBtn.onclick = () => {
                            const printWindow = window.open(pdfUrl, '_blank');
                            printWindow.onload = function() {
                                printWindow.print();
                            };
                        };
                    }
                    
                    if (pdfCloseBtn) {
                        pdfCloseBtn.onclick = () => {
                            pdfViewerModal.style.display = 'none';
                        };
                    }
                    
                    if (closePdfViewer) {
                        closePdfViewer.onclick = () => {
                            pdfViewerModal.style.display = 'none';
                        };
                    }
                    
                    // Fecha o modal ao clicar fora
                    pdfViewerModal.onclick = (e) => {
                        if (e.target === pdfViewerModal) {
                            pdfViewerModal.style.display = 'none';
                        }
                    };
                }

                showNotification('PDF gerado com sucesso!');

            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF: ' + error.message, 'error');
            }
        };
        
        // Compartilha or√ßamento
        const shareBudget = async (id) => {
            try {
                const budget = await getBudgetById(id);
                if (!budget) return;
                
                // Primeiro geramos o PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const margin = 15;
                const pageWidth = doc.internal.pageSize.getWidth();
                const contentWidth = pageWidth - (margin * 2);
                
                let y = margin;
                
                // Logo da empresa
                if (companyData.logo) {
                    try {
                        const logo = new Image();
                        logo.src = companyData.logo;
                        
                        await new Promise(resolve => {
                            logo.onload = resolve;
                            logo.onerror = resolve;
                        });
                        
                        const logoWidth = 40;
                        const logoHeight = (logo.height * logoWidth) / logo.width;
                        
                        if (logoHeight > 0) {
                            doc.addImage(companyData.logo, 'PNG', margin, margin, logoWidth, logoHeight);
                            y += logoHeight + 5;
                        }
                    } catch (e) {
                        console.error('Erro ao adicionar logo:', e);
                    }
                }
                
                // Dados da empresa
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(companyData.name, pageWidth / 2, y, null, null, 'center');
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(companyData.address, pageWidth / 2, y + 7, null, null, 'center');
                doc.text(companyData.contact, pageWidth / 2, y + 14, null, null, 'center');
                
                // Linha divis√≥ria
                y += 22;
                doc.setLineWidth(0.5);
                doc.line(margin, y, pageWidth - margin, y);
                
                // T√≠tulo do or√ßamento
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text(`OR√áAMENTO #${budget.number}`, pageWidth / 2, y + 15, null, null, 'center');
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Data: ${new Date(budget.timestamp).toLocaleDateString()}`, pageWidth - margin, y + 10, { align: 'right' });
                
                // Dados do cliente
                const clientY = y + 25;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('DADOS DO CLIENTE', margin, clientY);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Nome: ${budget.clientName}`, margin, clientY + 7);
                doc.text(`Endere√ßo: ${budget.clientAddress || 'N√£o informado'}`, margin, clientY + 14);
                doc.text(`Contato: ${budget.clientContact || 'N√£o informado'}`, margin, clientY + 21);
                
                // Detalhes do or√ßamento
                const detailsY = clientY + 32;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('DETALHES DO OR√áAMENTO', margin, detailsY);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Respons√°vel T√©cnico: ${budget.techManager || 'N√£o informado'}`, margin, detailsY + 7);
                doc.text(`Prazo de Entrega: ${budget.deliveryDays || 'A combinar'}`, margin, detailsY + 14);
                doc.text(`Forma de Pagamento: ${budget.paymentMethod || 'A combinar'}`, margin, detailsY + 21);
                doc.text(`Valor Total: R$ ${parseFloat(budget.totalValue).toFixed(2)}`, margin, detailsY + 28);
                
                // Descri√ß√£o dos servi√ßos
                const servicesY = detailsY + 38;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('DESCRI√á√ÉO DOS SERVI√áOS', margin, servicesY);
                
                const servicesLines = doc.splitTextToSize(budget.services, contentWidth);
                doc.setFontSize(10);
                doc.text(servicesLines, margin, servicesY + 7);
                
                // Assinatura
                const lastTextY = servicesY + 7 + (servicesLines.length * 5);
                const signatureY = Math.max(lastTextY + 20, 250);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('ASSINATURA', margin, signatureY);
                
                doc.setLineWidth(0.5);
                doc.line(margin, signatureY + 10, margin + 70, signatureY + 10);
                doc.setFontSize(9);
                doc.text('Cliente', margin, signatureY + 20);
                
                doc.line(pageWidth - margin - 70, signatureY + 10, pageWidth - margin, signatureY + 10);
                doc.text('Respons√°vel T√©cnico', pageWidth - margin - 70, signatureY + 20);
                
                // Gera o PDF como blob
                const pdfBlob = doc.output('blob');
                
                // Cria um objeto File para compartilhamento
                const pdfFile = new File([pdfBlob], `orcamento_${budget.number}.pdf`, { type: 'application/pdf' });
                
                // Verifica se a API de compartilhamento est√° dispon√≠vel
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: `Or√ßamento #${budget.number}`,
                            text: `Or√ßamento para ${budget.clientName} - Valor: R$ ${parseFloat(budget.totalValue).toFixed(2)}`,
                            files: [pdfFile]
                        });
                    } catch (error) {
                        console.error('Erro ao compartilhar:', error);
                        // Se o usu√°rio cancelar ou ocorrer erro, faz download normal
                        doc.save(`orcamento_${budget.number}.pdf`);
                    }
                } else {
                    // Fallback para navegadores sem suporte a compartilhamento
                    doc.save(`orcamento_${budget.number}.pdf`);
                    showNotification('Seu navegador n√£o suporta compartilhamento direto. O PDF foi baixado.', 'warning');
                }
                
            } catch (error) {
                console.error('Erro ao compartilhar or√ßamento:', error);
                showNotification('Erro ao compartilhar or√ßamento: ' + error.message, 'error');
            }
        };
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await openDB();
                await loadCompanyData();
                updateCompanyInfoDisplay();
                
                // Modal de configura√ß√£o da empresa
                const companyModal = document.getElementById('company-modal');
                const btnCompanyConfig = document.getElementById('btn-company-config');
                const closeCompanyModal = document.getElementById('close-company-modal');
                
                if (btnCompanyConfig && companyModal && closeCompanyModal) {
                    btnCompanyConfig.addEventListener('click', () => {
                        const companyNameInput = document.getElementById('company-name-input');
                        const companyAddressInput = document.getElementById('company-address-input');
                        const companyContactInput = document.getElementById('company-contact-input');
                        
                        if (companyNameInput) companyNameInput.value = companyData.name;
                        if (companyAddressInput) companyAddressInput.value = companyData.address;
                        if (companyContactInput) companyContactInput.value = companyData.contact;
                        
                        // Configurar preview da logo
                        const companyLogoPreview = document.getElementById('company-logo-preview');
                        if (companyData.logo && companyLogoPreview) {
                            companyLogoPreview.src = companyData.logo;
                            companyLogoPreview.style.display = 'block';
                            const uploadSpan = document.querySelector('#company-logo-upload-area span');
                            if (uploadSpan) uploadSpan.style.display = 'none';
                        } else if (companyLogoPreview) {
                            companyLogoPreview.style.display = 'none';
                            const uploadSpan = document.querySelector('#company-logo-upload-area span');
                            if (uploadSpan) uploadSpan.style.display = 'block';
                        }
                        
                        companyModal.style.display = 'flex';
                    });
                    
                    closeCompanyModal.addEventListener('click', () => {
                        companyModal.style.display = 'none';
                    });
                    
                    window.addEventListener('click', (e) => {
                        if (e.target === companyModal) {
                            companyModal.style.display = 'none';
                        }
                    });
                }
                
                // Upload de logo da empresa
                const companyLogoUpload = document.getElementById('company-logo-upload');
                const companyLogoUploadArea = document.getElementById('company-logo-upload-area');
                const companyLogoPreview = document.getElementById('company-logo-preview');
                
                if (companyLogoUploadArea && companyLogoUpload) {
                    companyLogoUploadArea.addEventListener('click', () => companyLogoUpload.click());
                    
                    companyLogoUpload.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            try {
                                companyData.logo = await convertImageToBase64(file);
                                if (companyLogoPreview) {
                                    companyLogoPreview.src = companyData.logo;
                                    companyLogoPreview.style.display = 'block';
                                    const uploadSpan = document.querySelector('#company-logo-upload-area span');
                                    if (uploadSpan) uploadSpan.style.display = 'none';
                                }
                                
                                // Atualiza o logo na visualiza√ß√£o principal
                                const companyLogoImg = document.getElementById('company-logo-img');
                                if (companyLogoImg) {
                                    companyLogoImg.src = companyData.logo;
                                    companyLogoImg.style.display = 'block';
                                }
                            } catch (error) {
                                console.error('Erro ao processar imagem:', error);
                                showNotification('Erro ao carregar a imagem. Tente novamente com outra imagem.', 'error');
                            }
                        }
                    });
                }
                
                // Salvar configura√ß√µes da empresa
                const btnSaveCompany = document.getElementById('btn-save-company');
                if (btnSaveCompany) {
                    btnSaveCompany.addEventListener('click', async () => {
                        const companyNameInput = document.getElementById('company-name-input');
                        const companyAddressInput = document.getElementById('company-address-input');
                        const companyContactInput = document.getElementById('company-contact-input');
                        
                        if (companyNameInput) companyData.name = companyNameInput.value || companyData.name;
                        if (companyAddressInput) companyData.address = companyAddressInput.value || companyData.address;
                        if (companyContactInput) companyData.contact = companyContactInput.value || companyData.contact;
                        
                        await saveCompanyData();
                        updateCompanyInfoDisplay();
                        const companyModal = document.getElementById('company-modal');
                        if (companyModal) companyModal.style.display = 'none';
                    });
                }
                
                // Mostrar/ocultar views
                const btnShowForm = document.getElementById('btn-show-form');
                const btnShowList = document.getElementById('btn-show-list');
                const btnShowReports = document.getElementById('btn-show-reports');
                const formView = document.getElementById('form-view');
                const listView = document.getElementById('list-view');
                const reportsView = document.getElementById('reports-view');
                
                const showView = (viewToShow) => {
                    if (formView) formView.style.display = 'none';
                    if (listView) listView.style.display = 'none';
                    if (reportsView) reportsView.style.display = 'none';
                    
                    if (btnShowForm) btnShowForm.classList.remove('active');
                    if (btnShowList) btnShowList.classList.remove('active');
                    if (btnShowReports) btnShowReports.classList.remove('active');
                    
                    if (viewToShow === 'form' && formView) {
                        formView.style.display = 'block';
                        if (btnShowForm) btnShowForm.classList.add('active');
                    } else if (viewToShow === 'list' && listView) {
                        listView.style.display = 'block';
                        if (btnShowList) btnShowList.classList.add('active');
                        renderBudgetList();
                    } else if (viewToShow === 'reports' && reportsView) {
                        reportsView.style.display = 'block';
                        if (btnShowReports) btnShowReports.classList.add('active');
                    }
                };
                
                if (btnShowForm) {
                    btnShowForm.addEventListener('click', () => showView('form'));
                }
                
                if (btnShowList) {
                    btnShowList.addEventListener('click', () => showView('list'));
                }
                
                if (btnShowReports) {
                    btnShowReports.addEventListener('click', () => showView('reports'));
                }
                
                // Bot√£o salvar/atualizar
                const btnSave = document.getElementById('btn-save');
                if (btnSave) {
                    btnSave.addEventListener('click', async () => {
                        const clientName = document.getElementById('client-name')?.value;
                        const clientAddress = document.getElementById('client-address')?.value;
                        const clientContact = document.getElementById('client-contact')?.value;
                        const techManager = document.getElementById('tech-manager')?.value;
                        const services = document.getElementById('services')?.value;
                        const deliveryDays = document.getElementById('delivery-days')?.value;
                        const paymentMethod = document.getElementById('payment-method')?.value;
                        const totalValue = document.getElementById('total-value')?.value;
                        const status = document.getElementById('status')?.value || 'pendente';
                        
                        if (!clientName || !services || !totalValue) {
                            showNotification('Por favor, preencha os campos obrigat√≥rios (Nome do Cliente, Servi√ßos e Valor Total)', 'error');
                            return;
                        }
                        
                        const nextNumber = await getNextBudgetNumber();
                        
                        const budget = {
                            number: nextNumber,
                            clientName,
                            clientAddress,
                            clientContact,
                            techManager,
                            services,
                            deliveryDays,
                            paymentMethod,
                            totalValue: parseFloat(totalValue),
                            timestamp: new Date().getTime(),
                            status: status
                        };
                        
                        if (currentBudgetId) {
                            budget.id = currentBudgetId;
                        }
                        
                        try {
                            await saveBudget(budget);
                            
                            if (currentBudgetId) {
                                showNotification('Or√ßamento atualizado com sucesso!');
                            } else {
                                showNotification('Or√ßamento salvo com sucesso!');
                            }
                            
                            // Resetar formul√°rio
                            const budgetForm = document.getElementById('budget-form');
                            if (budgetForm) budgetForm.reset();
                            currentBudgetId = null;
                            if (btnSave) btnSave.innerHTML = '<i class="fas fa-save"></i> Salvar Or√ßamento';
                            
                            // Esconde o campo de status
                            const statusGroup = document.getElementById('status-group');
                            if (statusGroup) statusGroup.style.display = 'none';
                            
                            // Atualiza a lista de or√ßamentos
                            await renderBudgetList();
                            
                            // Volta para a lista
                            showView('list');
                            
                        } catch (error) {
                            console.error(error);
                            showNotification('Erro ao salvar or√ßamento: ' + error, 'error');
                        }
                    });
                }
                
                // Bot√£o atualizar lista
                const btnRefresh = document.getElementById('btn-refresh');
                if (btnRefresh) {
                    btnRefresh.addEventListener('click', async () => {
                        await renderBudgetList();
                        showNotification('Lista de or√ßamentos atualizada!');
                    });
                }
                
                // Bot√£o de busca
                const searchBtn = document.getElementById('search-btn');
                const searchInput = document.getElementById('search-input');
                if (searchBtn && searchInput) {
                    searchBtn.addEventListener('click', async () => {
                        const query = searchInput.value.trim();
                        if (query === '') {
                            await renderBudgetList();
                            return;
                        }
                        
                        try {
                            const results = await searchBudgets(query);
                            await renderBudgetList(results);
                            showNotification(`${results.length} or√ßamento(s) encontrado(s) para "${query}"`);
                        } catch (error) {
                            showNotification('Erro na busca: ' + error, 'error');
                        }
                    });
                    
                    // Busca ao pressionar Enter
                    searchInput.addEventListener('keypress', async (e) => {
                        if (e.key === 'Enter') {
                            searchBtn.click();
                        }
                    });
                }
                
                // Bot√µes de relat√≥rio
                const btnGenerateReport = document.getElementById('btn-generate-report');
                const btnExportReport = document.getElementById('btn-export-report');
                const reportStatus = document.getElementById('report-status');
                const reportStartDate = document.getElementById('report-start-date');
                const reportEndDate = document.getElementById('report-end-date');
                
                if (btnGenerateReport) {
                    btnGenerateReport.addEventListener('click', async () => {
                        try {
                            const status = reportStatus?.value || 'todos';
                            const startDate = reportStartDate?.value;
                            const endDate = reportEndDate?.value;
                            
                            const budgets = await searchBudgetsByFilters({ status, startDate, endDate });
                            await renderReport(budgets);
                            
                            showNotification(`Relat√≥rio gerado com ${budgets.length} or√ßamento(s)`);
                            
                            // Configura o bot√£o de exporta√ß√£o
                            if (btnExportReport) {
                                btnExportReport.onclick = () => exportReportToExcel(budgets);
                            }
                        } catch (error) {
                            console.error('Erro ao gerar relat√≥rio:', error);
                            showNotification('Erro ao gerar relat√≥rio: ' + error.message, 'error');
                        }
                    });
                }
                
                // Inicializa a view padr√£o
                showView('form');
                
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                showNotification('Erro ao inicializar o sistema: ' + error, 'error');
            }
        });
    </script>
</body>
</html>